
{% extends 'administrator/base.html'%}
{% block content %}
<tbody>
    {% load custom_filters %}

    {% for day in days %}
        <tr>
            <th scope="row">{{ day }}</th>
            {% for period in periods %}
                <td>
                    {% with schedule as schedule_data %}
                        {% with schedule_data|get_item:day|default_if_none:{} as day_schedule %}
                            {% if day_schedule|get_item:period %}
                                <!-- Existing entry: Display Edit button -->
                                <button type="button" class="btn btn-warning open-modal" 
                                        data-day="{{ day }}" 
                                        data-period="{{ period }}" 
                                        data-subject="{{ day_schedule|get_item:period.subject.id }}" 
                                        data-teacher="{{ day_schedule|get_item:period.TEACHERID.id }}">
                                    Edit
                                </button>
                            {% else %}
                                <!-- No entry: Display Add button -->
                                <button type="button" class="btn btn-secondary open-modal" 
                                        data-day="{{ day }}" 
                                        data-period="{{ period }}">
                                    Add
                                </button>
                            {% endif %}
                        {% endwith %}
                    {% endwith %}
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
</tbody>                </div>
                <!-- Modal -->
                <div class="modal fade" id="addSubjectTeacherModal" tabindex="-1"
                    aria-labelledby="addSubjectTeacherLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addSubjectTeacherLabel"></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="subjectTeacherForm" method="post" action="/timetable">
                                    {% csrf_token %}
                                    <input type="text" name="CLASS" value="{{classno.id}}" id="">
                                    <input type="text" name="sem" value="{{sem}}">
                                    <input type="text" class="form-control" id="department" hidden>
                                    <input type="text" class="form-control" id="year" hidden>
                                    <div class="mb-3">
                                        <label for="day" class="form-label">Day</label>
                                        <input type="text" name="Day" class="form-control" id="day" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="period" class="form-label">Period</label>
                                        <input type="text" class="form-control" name="hour" id="period" readonly>
                                    </div>

                                    <div class="mb-3">
                                        <label for="subject" class="form-label">Subject</label>
                                        <select name="subject" id="" class="form-control" required>
                                            <option selected disabled>--Select Subject--</option>
                                            {% if val %}
                                                {% for i in val %}
                                                    <option value="{{i.id}}">{{i.subject}}</option>
                                                {% endfor %}
                                            {% else %}
                                                <option disabled>No subjects available</option>
                                            {% endif %}
                                        </select>
                                        
                           
                                    </div>
                                    <div class="mb-3">
                                        <label for="teacher" class="form-label">Teacher</label>
                                        <select name="TEACHERID" id="" class="form-control" required>
                                            <option selected disabled>--Select Teacher--</option>
                                            {% for i in c %}
                                            <option value="{{i.id}}">{{i.name}}</option>
                                        {% endfor %}
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Save</button>
                                    
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


        </div>
    </div>
    </div>
   {% endblock %}